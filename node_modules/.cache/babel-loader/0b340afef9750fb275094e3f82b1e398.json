{"ast":null,"code":"import _Loading from \"@ucloud-fe/react-components/lib/components/Loading\";\nimport _Icon from \"@ucloud-fe/react-components/lib/components/Icon\";\n\nvar _dec,\n    _class,\n    _class2,\n    _temp,\n    _jsxFileName = \"/Users/lixiqing/work/URTC-DEOM/src/container/speakerWrapper/index.jsx\";\n\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { deviceDetection } from \"urtc-sdk\";\nimport { observer, inject } from \"mobx-react\";\nimport file from \"../../common/music/test.wav\";\n/**\n * @param index\n * @param id\n */\n// 样式\n\nconst LoadingText = styled.span`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  line-height: 50px;\n  text-align: left;\n  box-sizing: \"border-box\";\n  padding-left: 80px;\n  display: inline-block;\n`;\nconst ErrorWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  line-height: 60px;\n  text-align: left;\n  box-sizing: \"border-box\";\n  color: #f44336;\n`;\nconst ItemWrapper = styled.div`\n  position: relative;\n  width: 247px;\n  background-color: rgb(56, 96, 244);\n  border-radius: 4px;\n  height: 30px;\n  font-size: 12px;\n  line-height: 30px;\n  text-align: center;\n  box-sizing: \"border-box\";\n  cursor: pointer;\n  color: #fff;\n  margin: 10px 0 0 15%;\n  overflow: hidden;\n\n  .bg {\n    background-color: #31386d;\n    height: 100%;\n    border-radius: 4px;\n    z-index: 1;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0%;\n  }\n  .content {\n    position: relative;\n    z-index: 2;\n  }\n`;\nlet SpeakerWrapper = (_dec = inject(\"store\"), _dec(_class = observer(_class = (_temp = _class2 = class SpeakerWrapper extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      volume: 0,\n      show: true,\n      errorInfo: null,\n      loading: false,\n      audioStatsPlay: false\n    };\n\n    this.testDevice = callback => {\n      const {\n        id\n      } = this.props;\n      deviceDetection({\n        audio: true,\n        video: false,\n        microphoneId: id\n      }, Result => {\n        if (Result.audio && Result.video) {\n          // 麦克风和摄像头都可有和，发布或预览时可启用麦克风和摄像头\n          this.setState({\n            show: true\n          });\n        } else if (Result.audio) {// 麦克风可用，发布或预览时能启用麦克风\n        } else if (Result.video) {\n          // 摄像头可用，发布或预览时能启用摄像头\n          this.setState({\n            show: false,\n            errorInfo: Result.audioError\n          });\n        } else {\n          this.setState({\n            show: false,\n            errorInfo: Result.audioError\n          });\n        }\n\n        callback && callback();\n      });\n    };\n\n    this.playAudio = () => {\n      const audio = document.createElement(\"audio\");\n\n      if (this.props.id) {\n        audio.src = file;\n        this.setState({\n          audioStatsPlay: true\n        });\n        setTimeout(() => {\n          this.setState({\n            audioStatsPlay: false\n          });\n        }, 1500);\n\n        if (audio.setSinkId) {\n          audio.setSinkId(this.props.id).then(() => {\n            console.log(\"检测扬声器ing\");\n            audio.play();\n          });\n        }\n      }\n    };\n  }\n\n  componentDidMount() {}\n\n  render() {\n    const {\n      show,\n      errorInfo,\n      loading,\n      audioStatsPlay\n    } = this.state;\n    return /*#__PURE__*/React.createElement(_Loading, {\n      loading: loading,\n      tip: /*#__PURE__*/React.createElement(LoadingText, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 14\n        }\n      }, \"\\u68C0\\u6D4B\\u4E2D...\"),\n      indicator: null,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 7\n      }\n    }, show ? /*#__PURE__*/React.createElement(ItemWrapper, {\n      onClick: this.playAudio,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"bg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 13\n      }\n    }, audioStatsPlay ? /*#__PURE__*/React.createElement(_Icon, {\n      type: \"pause\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 17\n      }\n    }) : /*#__PURE__*/React.createElement(_Icon, {\n      type: \"caret-right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 19\n      }\n    }), \"\\u70B9\\u6B64\\u6D4B\\u8BD5\\u58F0\\u97F3\")) : /*#__PURE__*/React.createElement(ErrorWrapper, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 13\n      }\n    }, errorInfo));\n  }\n\n}, _class2.defaultProps = {\n  index: 0,\n  id: null,\n  type: \"input\"\n}, _temp)) || _class) || _class);\nexport default SpeakerWrapper;","map":{"version":3,"sources":["/Users/lixiqing/work/URTC-DEOM/src/container/speakerWrapper/index.jsx"],"names":["React","styled","deviceDetection","observer","inject","file","LoadingText","span","ErrorWrapper","div","ItemWrapper","SpeakerWrapper","Component","state","volume","show","errorInfo","loading","audioStatsPlay","testDevice","callback","id","props","audio","video","microphoneId","Result","setState","audioError","playAudio","document","createElement","src","setTimeout","setSinkId","then","console","log","play","componentDidMount","render","defaultProps","index","type"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport styled from \"styled-components\";\nimport { Loading, Icon } from \"@ucloud-fe/react-components\";\nimport { deviceDetection } from \"urtc-sdk\";\nimport { observer, inject } from \"mobx-react\";\nimport file from \"../../common/music/test.wav\";\n\n/**\n * @param index\n * @param id\n */\n\n// 样式\nconst LoadingText = styled.span`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  line-height: 50px;\n  text-align: left;\n  box-sizing: \"border-box\";\n  padding-left: 80px;\n  display: inline-block;\n`;\n\nconst ErrorWrapper = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  line-height: 60px;\n  text-align: left;\n  box-sizing: \"border-box\";\n  color: #f44336;\n`;\n\nconst ItemWrapper = styled.div`\n  position: relative;\n  width: 247px;\n  background-color: rgb(56, 96, 244);\n  border-radius: 4px;\n  height: 30px;\n  font-size: 12px;\n  line-height: 30px;\n  text-align: center;\n  box-sizing: \"border-box\";\n  cursor: pointer;\n  color: #fff;\n  margin: 10px 0 0 15%;\n  overflow: hidden;\n\n  .bg {\n    background-color: #31386d;\n    height: 100%;\n    border-radius: 4px;\n    z-index: 1;\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0%;\n  }\n  .content {\n    position: relative;\n    z-index: 2;\n  }\n`;\n@inject(\"store\")\n@observer\nclass SpeakerWrapper extends React.Component {\n  static defaultProps = {\n    index: 0,\n    id: null,\n    type: \"input\",\n  };\n\n  state = {\n    volume: 0,\n    show: true,\n    errorInfo: null,\n    loading: false,\n    audioStatsPlay: false,\n  };\n\n  componentDidMount() { }\n\n  testDevice = (callback) => {\n    const { id } = this.props;\n    deviceDetection(\n      {\n        audio: true,\n        video: false,\n        microphoneId: id,\n      },\n      (Result) => {\n        if (Result.audio && Result.video) {\n          // 麦克风和摄像头都可有和，发布或预览时可启用麦克风和摄像头\n          this.setState({\n            show: true,\n          });\n        } else if (Result.audio) {\n          // 麦克风可用，发布或预览时能启用麦克风\n        } else if (Result.video) {\n          // 摄像头可用，发布或预览时能启用摄像头\n          this.setState({\n            show: false,\n            errorInfo: Result.audioError,\n          });\n        } else {\n          this.setState({\n            show: false,\n            errorInfo: Result.audioError,\n          });\n        }\n        callback && callback();\n      }\n    );\n  };\n\n  playAudio = () => {\n    const audio = document.createElement(\"audio\");\n    if (this.props.id) {\n      audio.src = file;\n      this.setState({\n        audioStatsPlay: true,\n      });\n\n      setTimeout(() => {\n        this.setState({\n          audioStatsPlay: false,\n        });\n      }, 1500);\n      if (audio.setSinkId) {\n        audio.setSinkId(this.props.id).then(() => {\n          console.log(\"检测扬声器ing\");\n          audio.play();\n        });\n      }\n\n    }\n  };\n\n  render() {\n    const { show, errorInfo, loading, audioStatsPlay } = this.state;\n    return (\n      <Loading\n        loading={loading}\n        tip={<LoadingText>检测中...</LoadingText>}\n        indicator={null}\n      >\n        {show ? (\n          <ItemWrapper onClick={this.playAudio}>\n            <div className=\"bg\"></div>\n            <div className=\"content\">\n              {audioStatsPlay ? (\n                <Icon type={\"pause\"} />\n              ) : (\n                  <Icon type={\"caret-right\"} />\n                )}\n              点此测试声音\n            </div>\n          </ItemWrapper>\n        ) : (\n            <ErrorWrapper>{errorInfo}</ErrorWrapper>\n          )}\n      </Loading>\n    );\n  }\n}\n\nexport default SpeakerWrapper;\n"]},"metadata":{},"sourceType":"module"}