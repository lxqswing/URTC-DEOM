{"ast":null,"code":"import _Modal from \"@ucloud-fe/react-components/lib/components/Modal\";\nimport _Notice from \"@ucloud-fe/react-components/lib/components/Notice\";\nimport _Row from \"@ucloud-fe/react-components/lib/components/Row\";\nimport _Col from \"@ucloud-fe/react-components/lib/components/Col\";\nimport _Steps from \"@ucloud-fe/react-components/lib/components/Steps\";\nimport _Message from \"@ucloud-fe/react-components/lib/components/Message\";\n\nvar _dec,\n    _class,\n    _class2,\n    _temp,\n    _jsxFileName = \"/Users/lixiqing/work/URTC-DEOM/src/components/testing/index.jsx\";\n\nimport React from \"react\";\nimport { observer, inject } from \"mobx-react\";\nimport { randNum } from \"../../util\";\nimport CameraTest from \"../cameraTest/index.jsx\";\nimport SpeakerTest from \"../speakerTest/index.jsx\";\nimport MicTest from \"../micTest/index.jsx\";\nimport { StepWrapper, ErrorWrapper, BtnWrapper, EndWrapper } from './index.styles';\nimport // isWeChat,\n'../../util/index';\nimport sdk, { Client, getDevices, isSupportWebRTC, deviceDetection } from \"urtc-sdk\";\nconst deviceType = {\n  AUDIOINPUT: {\n    type: \"audioinput\",\n    des: \"音频输入\"\n  },\n  //音频输入\n  AUDIOOUTPUT: {\n    type: \"audiooutput\",\n    des: \"音频输出\"\n  },\n  //音频输出\n  VIDEOINPUT: {\n    type: \"videoinput\",\n    des: \"视频输入\"\n  } //视频输入\n\n};\n/**\n * @param show  bool 必传，控制组件现实隐藏\n * @param close fun 必传, 关闭modal函数\n * @description 设备检测模块包含：rtc能力测试，音视频设备状态测试\n *\n */\n// 样式\n//模块\n\nlet Testing = (_dec = inject(\"store\"), _dec(_class = observer(_class = (_temp = _class2 = class Testing extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      allDeviceList: [],\n      audioInputDeviceList: [],\n      audioInputStream: [],\n      audioOutputDeviceList: [],\n      videoDeviceList: [],\n      rtcSupportFlag: false,\n      rtcSupportError: null,\n      errorInfo: \"\",\n      stepCurrent: 0,\n      steps: [{\n        title: \"摄像头检测\",\n        key: \"testVideo\"\n      }, {\n        title: \"扬声器检测\",\n        key: \"testSpeaker\"\n      }, {\n        title: \"麦克风检测\",\n        key: \"testMic\"\n      }, {\n        title: \"检测结果\",\n        key: \"end\"\n      }],\n      statusMap: {\n        camera: true,\n        speaker: true,\n        mic: true\n      }\n    };\n\n    this.next = () => {\n      let {\n        stepCurrent,\n        steps\n      } = this.state;\n\n      if (stepCurrent === steps.length - 1) {\n        return;\n      }\n\n      let num = stepCurrent + 1;\n      this.setState({\n        stepCurrent: num\n      });\n    };\n\n    this.prev = () => {\n      let {\n        stepCurrent\n      } = this.state;\n\n      if (stepCurrent === 0) {\n        return;\n      }\n\n      let num = stepCurrent - 1;\n      this.setState({\n        stepCurrent: num\n      });\n    };\n\n    this.destroy = id => {\n      if (id) {\n        console.log(\"开始销毁流>>>\");\n        this.store = this.props.store.testingStore;\n        this.store.sdkClient.destroyStream(id, error => {\n          if (error) {\n            console.log(`销毁流失败>>>:`, error);\n          } else {\n            console.log(`销毁流成功>>>`);\n          }\n        });\n      }\n    };\n\n    this.destroyAll = () => {\n      this.store = this.props.store.testingStore;\n      const result = this.store.sdkClient.getLocalStreams();\n\n      for (let index = 0; index < result.length; index++) {\n        const element = result[index];\n        this.destroy(element.previewId);\n      }\n    };\n\n    this.initRtc = () => {\n      const storeData = this.props.store.settings;\n      let roomId = `testDevice${randNum(8)}`;\n      let userId = randNum(8);\n      const AppId = storeData.AppId;\n      const AppKey = storeData.AppKey;\n      let token = sdk.generateToken(AppId, AppKey, roomId, userId);\n      this.client = new Client(AppId, token);\n      this.props.store.testingStore.setSdkClient(this.client);\n    };\n\n    this.getDevicesList = () => {\n      const {\n        audioInputDeviceList,\n        audioOutputDeviceList,\n        videoDeviceList\n      } = this.state;\n      getDevices(MediaDeviceInfos => {\n        console.log(\"MediaDeviceInfos\", MediaDeviceInfos);\n        this.setState({\n          allDeviceList: MediaDeviceInfos\n        });\n\n        for (let index = 0; index < MediaDeviceInfos.length; index++) {\n          const element = MediaDeviceInfos[index]; // 音频输入\n\n          if (element.kind === deviceType.AUDIOINPUT.type) {\n            audioInputDeviceList.push(element);\n          } // 音频输出\n\n\n          if (element.kind === deviceType.AUDIOOUTPUT.type) {\n            audioOutputDeviceList.push(element);\n          } // 视频输入\n\n\n          if (element.kind === deviceType.VIDEOINPUT.type) {\n            videoDeviceList.push(element);\n          }\n        }\n\n        this.setState({\n          audioInputDeviceList,\n          audioOutputDeviceList,\n          videoDeviceList\n        });\n        console.log(\"getDevicesList success\", audioInputDeviceList, audioOutputDeviceList, videoDeviceList);\n      }, error => {\n        console.log(\"getDevicesList fail\", error);\n\n        _Message.error(error);\n\n        this.getDevicesList();\n      });\n    };\n\n    this.closeModal = () => {\n      this.destroyAll();\n      this.props.close && this.props.close();\n    };\n\n    this.changeType = e => {\n      this.setState({\n        selectType: e\n      });\n    };\n\n    this.testRtcSupport = () => {\n      const result = isSupportWebRTC();\n\n      if (result) {\n        this.setState({\n          rtcSupportFlag: true\n        });\n      }\n\n      deviceDetection({\n        audio: true,\n        video: true\n      }, Result => {\n        console.log(Result);\n\n        if (Result.audio && Result.video) {// 麦克风和摄像头都可，发布或预览时可启用麦克风和摄像头\n        } else if (Result.audio) {\n          // 麦克风可用，发布或预览时能启用麦克风\n          this.setState({\n            rtcSupportFlag: false,\n            errorInfo: `摄像头不可用:${Result.videoError}`\n          });\n        } else if (Result.video) {\n          // 摄像头可用，发布或预览时能启用摄像头\n          this.setState({\n            rtcSupportFlag: false,\n            errorInfo: `麦克风不可用:${Result.audioError}`\n          });\n        } else {\n          // 麦克风和摄像头都不可用\n          this.setState({\n            rtcSupportFlag: false,\n            errorInfo: `麦克风和摄像头皆不可用:${Result.audioError}`\n          });\n        }\n      });\n    };\n\n    this.testSuc = type => {\n      let _s = this.state.statusMap;\n      _s[type] = true;\n      this.setState({\n        statusMap: _s\n      });\n      this.next();\n    };\n\n    this.reset = () => {\n      this.setState({\n        stepCurrent: 0\n      });\n    };\n\n    this.testFail = type => {\n      let _s = this.state.statusMap;\n      _s[type] = false;\n      this.setState({\n        statusMap: _s\n      });\n      this.next();\n    };\n\n    this.renderBtn = () => {\n      const {\n        camera = true,\n        speaker = true,\n        mic = true\n      } = this.state.statusMap;\n\n      if (camera && speaker && mic) {\n        return /*#__PURE__*/React.createElement(BtnWrapper, {\n          onClick: this.closeModal,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 9\n          }\n        }, \"\\u5173\\u95ED\");\n      } else {\n        return /*#__PURE__*/React.createElement(BtnWrapper, {\n          onClick: this.reset,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 289,\n            columnNumber: 15\n          }\n        }, \"\\u91CD\\u65B0\\u68C0\\u6D4B\");\n      }\n    };\n\n    console.log(this.state);\n  }\n\n  componentDidMount() {\n    this.testRtcSupport();\n    this.getDevicesList();\n    this.initRtc();\n  }\n\n  render() {\n    const {\n      show\n    } = this.props;\n    const {\n      rtcSupportFlag,\n      errorInfo,\n      stepCurrent,\n      steps,\n      videoDeviceList,\n      audioOutputDeviceList,\n      audioInputDeviceList,\n      statusMap\n    } = this.state; // const {} = this.props.store;\n\n    console.log(statusMap);\n    return /*#__PURE__*/React.createElement(_Modal, {\n      visible: show,\n      title: \"检测\",\n      size: \"md\" // width={560}\n      ,\n      onClose: this.closeModal,\n      afterClose: this.destroyAll,\n      footer: null,\n      destroyOnClose: false,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 7\n      }\n    }, rtcSupportFlag && videoDeviceList.length ? /*#__PURE__*/React.createElement(StepWrapper, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(_Steps, {\n      steps: steps,\n      current: steps[stepCurrent].key,\n      status: \"current\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 13\n      }\n    }), stepCurrent === 0 && /*#__PURE__*/React.createElement(CameraTest, {\n      client: this.client,\n      list: videoDeviceList,\n      onOk: this.testSuc.bind(this, \"camera\"),\n      onCancel: this.testFail.bind(this, \"camera\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 15\n      }\n    }), stepCurrent === 1 && /*#__PURE__*/React.createElement(SpeakerTest, {\n      client: this.client,\n      list: audioOutputDeviceList,\n      onOk: this.testSuc.bind(this, \"speaker\"),\n      onCancel: this.testFail.bind(this, \"speaker\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 15\n      }\n    }), stepCurrent === 2 && /*#__PURE__*/React.createElement(MicTest, {\n      client: this.client,\n      list: audioInputDeviceList,\n      onOk: this.testSuc.bind(this, \"mic\"),\n      onCancel: this.testFail.bind(this, \"mic\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 15\n      }\n    }), stepCurrent === 3 && /*#__PURE__*/React.createElement(EndWrapper, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 352,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(_Row, {\n      gutter: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(_Col, {\n      offset: 2,\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 23\n      }\n    }, \"\\u68C0\\u6D4B\\u9879\\u76EE\")), /*#__PURE__*/React.createElement(_Col, {\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 23\n      }\n    }, \"\\u68C0\\u6D4B\\u7ED3\\u679C\"))), /*#__PURE__*/React.createElement(_Row, {\n      gutter: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(_Col, {\n      offset: 2,\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 363,\n        columnNumber: 23\n      }\n    }, \"\\u6444\\u50CF\\u5934\")), /*#__PURE__*/React.createElement(_Col, {\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 23\n      }\n    }, statusMap.camera ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 27\n      }\n    }, \"\\u6B63\\u5E38\") : /*#__PURE__*/React.createElement(\"p\", {\n      className: \"error\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 29\n      }\n    }, \"\\u5F02\\u5E38\")))), /*#__PURE__*/React.createElement(_Row, {\n      gutter: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(_Col, {\n      offset: 2,\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 23\n      }\n    }, \"\\u626C\\u58F0\\u5668\")), /*#__PURE__*/React.createElement(_Col, {\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 23\n      }\n    }, statusMap.speaker ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 27\n      }\n    }, \"\\u6B63\\u5E38\") : /*#__PURE__*/React.createElement(\"p\", {\n      className: \"error\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 29\n      }\n    }, \"\\u5F02\\u5E38\")))), /*#__PURE__*/React.createElement(_Row, {\n      gutter: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(_Col, {\n      offset: 2,\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"left\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 23\n      }\n    }, \"\\u9EA6\\u514B\\u98CE\")), /*#__PURE__*/React.createElement(_Col, {\n      span: 4,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"right\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 23\n      }\n    }, statusMap.mic ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 27\n      }\n    }, \"\\u6B63\\u5E38\") : /*#__PURE__*/React.createElement(\"p\", {\n      className: \"error\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 29\n      }\n    }, \"\\u5F02\\u5E38\"))))), !statusMap.mic && /*#__PURE__*/React.createElement(\"p\", {\n      className: \"errorInfo\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 19\n      }\n    }, \"\\u5F53\\u524D\\u60A8\\u7684\\u9EA6\\u514B\\u98CE\\u5F02\\u5E38\\uFF0C\\u65E0\\u6CD5\\u8FDB\\u5165\\u76F4\\u64AD\"), this.renderBtn())) : /*#__PURE__*/React.createElement(ErrorWrapper, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(_Notice, {\n      closable: false,\n      styleType: \"error\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 15\n      }\n    }, errorInfo)));\n  }\n\n}, _class2.defaultProps = {\n  show: false\n}, _temp)) || _class) || _class);\nexport default Testing;","map":{"version":3,"sources":["/Users/lixiqing/work/URTC-DEOM/src/components/testing/index.jsx"],"names":["React","observer","inject","randNum","CameraTest","SpeakerTest","MicTest","StepWrapper","ErrorWrapper","BtnWrapper","EndWrapper","sdk","Client","getDevices","isSupportWebRTC","deviceDetection","deviceType","AUDIOINPUT","type","des","AUDIOOUTPUT","VIDEOINPUT","Testing","Component","constructor","props","state","allDeviceList","audioInputDeviceList","audioInputStream","audioOutputDeviceList","videoDeviceList","rtcSupportFlag","rtcSupportError","errorInfo","stepCurrent","steps","title","key","statusMap","camera","speaker","mic","next","length","num","setState","prev","destroy","id","console","log","store","testingStore","sdkClient","destroyStream","error","destroyAll","result","getLocalStreams","index","element","previewId","initRtc","storeData","settings","roomId","userId","AppId","AppKey","token","generateToken","client","setSdkClient","getDevicesList","MediaDeviceInfos","kind","push","closeModal","close","changeType","e","selectType","testRtcSupport","audio","video","Result","videoError","audioError","testSuc","_s","reset","testFail","renderBtn","componentDidMount","render","show","bind","defaultProps"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {\n  Modal,\n  Steps,\n  Notice,\n  Row,\n  Col,\n  Message,\n} from \"@ucloud-fe/react-components\";\nimport { observer, inject } from \"mobx-react\";\nimport { randNum } from \"../../util\";\nimport CameraTest from \"../cameraTest/index.jsx\";\nimport SpeakerTest from \"../speakerTest/index.jsx\";\nimport MicTest from \"../micTest/index.jsx\";\nimport {\n  StepWrapper, ErrorWrapper, BtnWrapper, EndWrapper\n} from './index.styles'\nimport {\n  // isWeChat,\n} from '../../util/index'\nimport sdk, {\n  Client,\n  getDevices,\n  isSupportWebRTC,\n  deviceDetection,\n} from \"urtc-sdk\";\n\nconst deviceType = {\n  AUDIOINPUT: {\n    type: \"audioinput\",\n    des: \"音频输入\",\n  }, //音频输入\n  AUDIOOUTPUT: {\n    type: \"audiooutput\",\n    des: \"音频输出\",\n  }, //音频输出\n  VIDEOINPUT: {\n    type: \"videoinput\",\n    des: \"视频输入\",\n  }, //视频输入\n};\n\n/**\n * @param show  bool 必传，控制组件现实隐藏\n * @param close fun 必传, 关闭modal函数\n * @description 设备检测模块包含：rtc能力测试，音视频设备状态测试\n *\n */\n\n// 样式\n//模块\n@inject(\"store\")\n@observer\nclass Testing extends React.Component {\n  static defaultProps = {\n    show: false,\n  };\n\n  state = {\n    allDeviceList: [],\n    audioInputDeviceList: [],\n    audioInputStream: [],\n    audioOutputDeviceList: [],\n    videoDeviceList: [],\n    rtcSupportFlag: false,\n    rtcSupportError: null,\n    errorInfo: \"\",\n    stepCurrent: 0,\n    steps: [\n      {\n        title: \"摄像头检测\",\n        key: \"testVideo\",\n      },\n      {\n        title: \"扬声器检测\",\n        key: \"testSpeaker\",\n      },\n      {\n        title: \"麦克风检测\",\n        key: \"testMic\",\n      },\n      {\n        title: \"检测结果\",\n        key: \"end\",\n      },\n    ],\n    statusMap: {\n      camera: true,\n      speaker: true,\n      mic: true,\n    },\n  };\n  constructor(props) {\n    super(props);\n    console.log(this.state);\n  }\n\n  componentDidMount() {\n    this.testRtcSupport();\n    this.getDevicesList();\n    this.initRtc();\n  }\n\n  next = () => {\n    let { stepCurrent, steps } = this.state;\n    if (stepCurrent === steps.length - 1) {\n      return;\n    }\n    let num = stepCurrent + 1;\n    this.setState({\n      stepCurrent: num,\n    });\n  };\n\n  prev = () => {\n    let { stepCurrent } = this.state;\n    if (stepCurrent === 0) {\n      return;\n    }\n    let num = stepCurrent - 1;\n    this.setState({\n      stepCurrent: num,\n    });\n  };\n\n  destroy = (id) => {\n    if (id) {\n      console.log(\"开始销毁流>>>\");\n      this.store = this.props.store.testingStore;\n      this.store.sdkClient.destroyStream(id, (error) => {\n        if (error) {\n          console.log(`销毁流失败>>>:`, error);\n        } else {\n          console.log(`销毁流成功>>>`);\n        }\n      });\n    }\n  };\n\n  destroyAll = () => {\n    this.store = this.props.store.testingStore;\n    const result = this.store.sdkClient.getLocalStreams();\n    for (let index = 0; index < result.length; index++) {\n      const element = result[index];\n      this.destroy(element.previewId);\n    }\n  };\n\n  initRtc = () => {\n    const storeData = this.props.store.settings;\n    let roomId = `testDevice${randNum(8)}`;\n    let userId = randNum(8);\n    const AppId = storeData.AppId;\n    const AppKey = storeData.AppKey;\n    let token = sdk.generateToken(AppId, AppKey, roomId, userId);\n    this.client = new Client(AppId, token);\n    this.props.store.testingStore.setSdkClient(this.client);\n  };\n\n  getDevicesList = () => {\n    const {\n      audioInputDeviceList,\n      audioOutputDeviceList,\n      videoDeviceList,\n    } = this.state;\n    getDevices(\n      (MediaDeviceInfos) => {\n        console.log(\"MediaDeviceInfos\", MediaDeviceInfos)\n        this.setState({\n          allDeviceList: MediaDeviceInfos,\n        });\n        for (let index = 0; index < MediaDeviceInfos.length; index++) {\n          const element = MediaDeviceInfos[index];\n          // 音频输入\n          if (element.kind === deviceType.AUDIOINPUT.type) {\n            audioInputDeviceList.push(element);\n          }\n          // 音频输出\n          if (element.kind === deviceType.AUDIOOUTPUT.type) {\n            audioOutputDeviceList.push(element);\n          }\n          // 视频输入\n          if (element.kind === deviceType.VIDEOINPUT.type) {\n            videoDeviceList.push(element);\n          }\n        }\n        this.setState({\n          audioInputDeviceList,\n          audioOutputDeviceList,\n          videoDeviceList,\n        });\n        console.log(\n          \"getDevicesList success\",\n          audioInputDeviceList,\n          audioOutputDeviceList,\n          videoDeviceList\n        );\n      },\n      (error) => {\n        console.log(\"getDevicesList fail\", error);\n        Message.error(error);\n        this.getDevicesList();\n      }\n    );\n  };\n\n  closeModal = () => {\n    this.destroyAll();\n    this.props.close && this.props.close();\n  };\n\n  changeType = (e) => {\n    this.setState({\n      selectType: e,\n    });\n  };\n\n  testRtcSupport = () => {\n    const result = isSupportWebRTC();\n    if (result) {\n      this.setState({\n        rtcSupportFlag: true,\n      });\n    }\n    deviceDetection(\n      {\n        audio: true,\n        video: true,\n      },\n      (Result) => {\n        console.log(Result);\n        if (Result.audio && Result.video) {\n          // 麦克风和摄像头都可，发布或预览时可启用麦克风和摄像头\n        } else if (Result.audio) {\n          // 麦克风可用，发布或预览时能启用麦克风\n          this.setState({\n            rtcSupportFlag: false,\n            errorInfo: `摄像头不可用:${Result.videoError}`,\n          });\n        } else if (Result.video) {\n          // 摄像头可用，发布或预览时能启用摄像头\n          this.setState({\n            rtcSupportFlag: false,\n            errorInfo: `麦克风不可用:${Result.audioError}`,\n          });\n        } else {\n          // 麦克风和摄像头都不可用\n          this.setState({\n            rtcSupportFlag: false,\n            errorInfo: `麦克风和摄像头皆不可用:${Result.audioError}`,\n          });\n        }\n      }\n    );\n  };\n\n  testSuc = (type) => {\n    let _s = this.state.statusMap;\n    _s[type] = true;\n    this.setState({\n      statusMap: _s,\n    });\n    this.next();\n  };\n\n  reset = () => {\n    this.setState({\n      stepCurrent: 0,\n    });\n  };\n\n  testFail = (type) => {\n    let _s = this.state.statusMap;\n    _s[type] = false;\n    this.setState({\n      statusMap: _s,\n    });\n    this.next();\n  };\n\n\n  renderBtn = () => {\n    const { camera = true, speaker = true, mic = true, } = this.state.statusMap;\n    if (camera && speaker && mic) {\n      return (\n        <BtnWrapper onClick={this.closeModal}>关闭</BtnWrapper>\n      )\n    } else {\n      return (<BtnWrapper onClick={this.reset}>重新检测</BtnWrapper>)\n    }\n  }\n\n  render() {\n    const { show } = this.props;\n    const {\n      rtcSupportFlag,\n      errorInfo,\n      stepCurrent,\n      steps,\n      videoDeviceList,\n      audioOutputDeviceList,\n      audioInputDeviceList,\n      statusMap,\n    } = this.state;\n    // const {} = this.props.store;\n    console.log(statusMap);\n    return (\n      <Modal\n        visible={show}\n        title={\"检测\"}\n        size=\"md\"\n        // width={560}\n        onClose={this.closeModal}\n        afterClose={this.destroyAll}\n        footer={null}\n        destroyOnClose={false}\n      >\n        {rtcSupportFlag && videoDeviceList.length ? (\n          <StepWrapper>\n            <Steps\n              steps={steps}\n              current={steps[stepCurrent].key}\n              status={\"current\"}\n            />\n            {stepCurrent === 0 && (\n              <CameraTest\n                client={this.client}\n                list={videoDeviceList}\n                onOk={this.testSuc.bind(this, \"camera\")}\n                onCancel={this.testFail.bind(this, \"camera\")}\n              />\n            )}\n\n            {stepCurrent === 1 && (\n              <SpeakerTest\n                client={this.client}\n                list={audioOutputDeviceList}\n                onOk={this.testSuc.bind(this, \"speaker\")}\n                onCancel={this.testFail.bind(this, \"speaker\")}\n              />\n            )}\n            {stepCurrent === 2 && (\n              <MicTest\n                client={this.client}\n                list={audioInputDeviceList}\n                onOk={this.testSuc.bind(this, \"mic\")}\n                onCancel={this.testFail.bind(this, \"mic\")}\n              />\n            )}\n            {stepCurrent === 3 && (\n              <EndWrapper>\n                <div className=\"content\">\n                  <Row gutter={0}>\n                    <Col offset={2} span={4}>\n                      <div className=\"left\">检测项目</div>\n                    </Col>\n                    <Col span={4}>\n                      <div className=\"right\">检测结果</div>\n                    </Col>\n                  </Row>\n                  <Row gutter={0}>\n                    <Col offset={2} span={4}>\n                      <div className=\"left\">摄像头</div>\n                    </Col>\n                    <Col span={4}>\n                      <div className=\"right\">\n                        {statusMap.camera ? (\n                          <p>正常</p>\n                        ) : (\n                            <p className=\"error\">异常</p>\n                          )}\n                      </div>\n                    </Col>\n                  </Row>\n                  <Row gutter={0}>\n                    <Col offset={2} span={4}>\n                      <div className=\"left\">扬声器</div>\n                    </Col>\n                    <Col span={4}>\n                      <div className=\"right\">\n                        {statusMap.speaker ? (\n                          <p>正常</p>\n                        ) : (\n                            <p className=\"error\">异常</p>\n                          )}\n                      </div>\n                    </Col>\n                  </Row>\n\n                  <Row gutter={0}>\n                    <Col offset={2} span={4}>\n                      <div className=\"left\">麦克风</div>\n                    </Col>\n                    <Col span={4}>\n                      <div className=\"right\">\n                        {statusMap.mic ? (\n                          <p>正常</p>\n                        ) : (\n                            <p className=\"error\">异常</p>\n                          )}\n                      </div>\n                    </Col>\n                  </Row>\n                </div>\n                {!statusMap.mic && (\n                  <p className=\"errorInfo\">当前您的麦克风异常，无法进入直播</p>\n                )}\n                {this.renderBtn()}\n              </EndWrapper>\n            )}\n          </StepWrapper>\n        ) : (\n            <ErrorWrapper>\n              <Notice closable={false} styleType={\"error\"}>\n                {errorInfo}\n              </Notice>\n            </ErrorWrapper>\n          )}\n      </Modal>\n    );\n  }\n}\n\nexport default Testing;\n"]},"metadata":{},"sourceType":"module"}